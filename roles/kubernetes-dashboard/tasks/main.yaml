---

########################################
# Install Kubernetes Dashboard & Ingress
########################################

- name: Install Kubernetes Dashboard
  shell: |
    kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/master/aio/deploy/recommended.yaml
  args:
    executable: /bin/bash

- name: Add a Dashboard Admin user account
  shell: |
    kubectl create -f {{ role_path }}/files/{{item}}.yaml
  args:
    executable: /bin/bash
  ignore_errors: true
  with_items:
    - ServiceAccount
    - ClusterRoleBinding

- name: "Setup Kubernetes Dashboard Ingress at kubernetes-dashboard.{{ dns_zone }}"
  shell: |
    echo "{{ lookup( 'template', 'template/dashboard-ingress.yaml.j2') }}" | kubectl apply -f -
  args:
    executable: /bin/bash

- import_role:
    name: helm-nginx-ingress
  vars:
    namespace: kubernetes-dashboard
    ssl_arn: arn:aws:acm:eu-west-1:996394622990:certificate/9176394a-e720-4869-ac2a-f9f2c433fa3a
